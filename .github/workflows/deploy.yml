name: Deploy to Hostinger

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: ðŸš€ Iniciando Deploy
      run: echo "Iniciando deploy para produÃ§Ã£o..."

    - name: ðŸ” Configurando SSH
      run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/deploy_key
        chmod 600 ~/.ssh/deploy_key
        ssh-keyscan -p ${{ secrets.SSH_PORT }} ${{ secrets.SSH_HOST }} >> ~/.ssh/known_hosts

    - name: ðŸ“¦ Deploy via SSH
      run: |
        ssh -i ~/.ssh/deploy_key -p ${{ secrets.SSH_PORT }} ${{ secrets.SSH_USERNAME }}@${{ secrets.SSH_HOST }} << 'ENDSSH'
          cd ${{ secrets.SSH_PATH }}

          echo "ðŸ“¥ Baixando atualizaÃ§Ãµes do GitHub..."
          git pull origin main

          echo "ðŸ“¦ Instalando dependÃªncias do Composer..."
          composer install --no-dev --optimize-autoloader --no-interaction

          echo "ðŸ§¹ Limpando caches do Laravel..."
          php artisan config:clear
          php artisan cache:clear
          php artisan route:clear
          php artisan view:clear

          echo "âš¡ Otimizando para produÃ§Ã£o..."
          php artisan config:cache
          php artisan route:cache
          php artisan view:cache

          echo "ðŸ—„ï¸ Rodando migrations..."
          php artisan migrate --force

          echo "âœ… Deploy concluÃ­do com sucesso!"
        ENDSSH

    - name: âœ… Deploy Finalizado
      run: echo "Deploy concluÃ­do com sucesso! ðŸŽ‰"
